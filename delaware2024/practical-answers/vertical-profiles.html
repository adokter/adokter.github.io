<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Vertical profiles | Introductory exercises with bioRad</title>
  <meta name="description" content="4 Vertical profiles | Introductory exercises with bioRad" />
  <meta name="generator" content="bookdown 0.40 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Vertical profiles | Introductory exercises with bioRad" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Vertical profiles | Introductory exercises with bioRad" />
  
  
  

<meta name="author" content="Adriaan M. Dokter" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="screening-out-weather.html"/>
<link rel="next" href="range-bias-correction.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a></li>
<li class="chapter" data-level="2" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html"><i class="fa fa-check"></i><b>2</b> Basic visualization of radar scans</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#the-structure-of-polar-volumes"><i class="fa fa-check"></i><b>2.1</b> The structure of polar volumes</a></li>
<li class="chapter" data-level="2.2" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#plotting-radar-scans"><i class="fa fa-check"></i><b>2.2</b> Plotting radar scans</a></li>
<li class="chapter" data-level="2.3" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#overlaying-radar-scans-on-maps"><i class="fa fa-check"></i><b>2.3</b> Overlaying radar scans on maps</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="screening-out-weather.html"><a href="screening-out-weather.html"><i class="fa fa-check"></i><b>3</b> Screening out weather</a>
<ul>
<li class="chapter" data-level="3.1" data-path="screening-out-weather.html"><a href="screening-out-weather.html#using-correlation-coefficient"><i class="fa fa-check"></i><b>3.1</b> using correlation coefficient</a></li>
<li class="chapter" data-level="3.2" data-path="screening-out-weather.html"><a href="screening-out-weather.html#using-mistnet"><i class="fa fa-check"></i><b>3.2</b> using MistNet</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vertical-profiles.html"><a href="vertical-profiles.html"><i class="fa fa-check"></i><b>4</b> Vertical profiles</a>
<ul>
<li class="chapter" data-level="4.1" data-path="vertical-profiles.html"><a href="vertical-profiles.html#loading-processed-vertical-profiles"><i class="fa fa-check"></i><b>4.1</b> Loading processed vertical profiles</a></li>
<li class="chapter" data-level="4.2" data-path="vertical-profiles.html"><a href="vertical-profiles.html#inspecting-single-vertical-profiles"><i class="fa fa-check"></i><b>4.2</b> Inspecting single vertical profiles</a></li>
<li class="chapter" data-level="4.3" data-path="vertical-profiles.html"><a href="vertical-profiles.html#plotting-vertical-profile-time-series"><i class="fa fa-check"></i><b>4.3</b> Plotting vertical profile time series</a></li>
<li class="chapter" data-level="4.4" data-path="vertical-profiles.html"><a href="vertical-profiles.html#vertical-and-time-integration-of-profiles"><i class="fa fa-check"></i><b>4.4</b> Vertical and time integration of profiles</a></li>
<li class="chapter" data-level="4.5" data-path="vertical-profiles.html"><a href="vertical-profiles.html#manipulating-vertical-profile-time-series-data"><i class="fa fa-check"></i><b>4.5</b> Manipulating vertical profile time series data</a></li>
<li class="chapter" data-level="4.6" data-path="vertical-profiles.html"><a href="vertical-profiles.html#inspecting-precipitation-signals-in-profiles"><i class="fa fa-check"></i><b>4.6</b> Inspecting precipitation signals in profiles</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="range-bias-correction.html"><a href="range-bias-correction.html"><i class="fa fa-check"></i><b>5</b> Range bias correction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="range-bias-correction.html"><a href="range-bias-correction.html#processing-a-polar-volume-into-a-profile"><i class="fa fa-check"></i><b>5.1</b> Processing a polar volume into a profile</a></li>
<li class="chapter" data-level="5.2" data-path="range-bias-correction.html"><a href="range-bias-correction.html#range-bias-correction-and-vertical-integration-on-a-map"><i class="fa fa-check"></i><b>5.2</b> Range bias correction and vertical integration on a map</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html"><i class="fa fa-check"></i><b>6</b> Processing many polar volumes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#accessing-radar-data"><i class="fa fa-check"></i><b>6.1</b> Accessing radar data</a></li>
<li class="chapter" data-level="6.2" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#processing-multiple-polar-volumes"><i class="fa fa-check"></i><b>6.2</b> Processing multiple polar volumes</a></li>
<li class="chapter" data-level="6.3" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#parallel-processing"><i class="fa fa-check"></i><b>6.3</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="further-analysis-outside-biorad.html"><a href="further-analysis-outside-biorad.html"><i class="fa fa-check"></i><b>7</b> Further analysis outside bioRad</a></li>
<li class="chapter" data-level="8" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>8</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="troubleshooting.html"><a href="troubleshooting.html#cannot-find-proj.db"><i class="fa fa-check"></i><b>8.1</b> Cannot find proj.db</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introductory exercises with bioRad</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vertical-profiles" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Vertical profiles<a href="vertical-profiles.html#vertical-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section you will learn to compute, interpret and analyze vertical profiles (vp’s). A vp consists of the (bird) density, speed and directions at different altitudes at the location of a single radar. It is typically calculated for all data within a cylinder of 35 km radius around the radar, i.e. only containing data at relatively short distances, where the radar beam is still sufficiently narrow to resolve altitude information.</p>
<p>Section 6 has examples that show how to process polar volume data into vertical profiles. To save time, we will start below with a list of pre-processed vertical profiles for the Brownsville radar in Texas (KBRO).</p>
<div id="loading-processed-vertical-profiles" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Loading processed vertical profiles<a href="vertical-profiles.html#loading-processed-vertical-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="vertical-profiles.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usually we would load processed vertical profiles (vp files) by:</span></span>
<span id="cb38-2"><a href="vertical-profiles.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># my_vplist &lt;- read_vpfiles(&quot;./your/directory/with/processed/profiles/goes/here&quot;)</span></span>
<span id="cb38-3"><a href="vertical-profiles.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># my_vplist contains after running the command a list of vertical profile (vp) objects</span></span>
<span id="cb38-4"><a href="vertical-profiles.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To save time, we load these data directly from file</span></span>
<span id="cb38-5"><a href="vertical-profiles.html#cb38-5" aria-hidden="true" tabindex="-1"></a>my_vplist <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_vpts/KBRO20170514.rds&quot;</span>)</span>
<span id="cb38-6"><a href="vertical-profiles.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># print the length of the vplist object. It should contain 95 profiles</span></span>
<span id="cb38-7"><a href="vertical-profiles.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(my_vplist)</span></code></pre></div>
<pre><code>## [1] 115</code></pre>
</div>
<div id="inspecting-single-vertical-profiles" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Inspecting single vertical profiles<a href="vertical-profiles.html#inspecting-single-vertical-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that you have loaded a list of vertical profiles, we can start exploring them. We will start with plotting and inspecting single vertical profiles, i.e. a single profile from the list of vp objects you have just loaded.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="vertical-profiles.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s extract a profile from the list, in this example the 41st profile:</span></span>
<span id="cb40-2"><a href="vertical-profiles.html#cb40-2" aria-hidden="true" tabindex="-1"></a>my_vp <span class="ot">&lt;-</span> my_vplist[[<span class="dv">41</span>]]</span>
<span id="cb40-3"><a href="vertical-profiles.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print some info for this profile to the console</span></span>
<span id="cb40-4"><a href="vertical-profiles.html#cb40-4" aria-hidden="true" tabindex="-1"></a>my_vp</span></code></pre></div>
<pre><code>##                Vertical profile (class vp)
## 
##        radar:  KBRO 
##       source:  RAD:KBGM,PLC:Brownsville 
## nominal time:  2017-05-14 05:58:00 
## generated by:  vol2bird 0.3.17</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="vertical-profiles.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># test whether this profile was collected at day time:</span></span>
<span id="cb42-2"><a href="vertical-profiles.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">check_night</span>(my_vp)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="vertical-profiles.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the vertical profile, in terms of reflectivity factor</span></span>
<span id="cb44-2"><a href="vertical-profiles.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vp, <span class="at">quantity =</span> <span class="st">&quot;dbz&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="vertical-profiles.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the vertical profile, in terms of (linear) reflectivity</span></span>
<span id="cb45-2"><a href="vertical-profiles.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vp, <span class="at">quantity =</span> <span class="st">&quot;eta&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
<p><code>eta</code> and <code>dbz</code> are closely related, the main difference is that reflectivity factors are logarithmic, and reflectivities linear. You can convert one into the other using <code>eta_to_dbz()</code> and <code>dbz_to_eta()</code> functions, which follows this simple formula:</p>
<pre><code>eta = (radar-wavelength dependent constant) * 10^(dbz/10)</code></pre>
<p>The reflectivity factor <code>dBZ</code> is the quantity used by most meteorologist. It has the useful property that at different radar wavelengths (e.g. S-band versus C-band) the same amount of precipitation shows up at similar reflectivity factors. The same holds for insects, as well as any other target that is much smaller than the radar wavelength (S-band = 10 cm, C-band = 5 cm), the so-called Rayleigh-scattering limit.</p>
<p>In the case of birds we are outside the Rayleigh limit, because birds are of similar size as the radar wavelength. In this limit reflectivity <code>eta</code> is more similar between S-band and C-band. <code>eta</code> is also more directly related to the density of birds, since <code>eta</code> can be expressed as (bird density) x (radar cross section per bird). For these two reasons, for weather radar ornithologists reflectivity <code>eta</code> is the more conventional unit.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="vertical-profiles.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s plot the vertical profile, in terms of bird density</span></span>
<span id="cb47-2"><a href="vertical-profiles.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vp, <span class="at">quantity =</span> <span class="st">&quot;dens&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="vertical-profiles.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print the currently assumed radar cross section (RCS) per bird:</span></span>
<span id="cb48-2"><a href="vertical-profiles.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rcs</span>(my_vp)</span></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p><strong>Exercise 5:</strong> If you change your assumption on the bird’s radar cross section in the previous example, and assume the RCS is 10 times as large, what will be the effect on the bird density profile?</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="vertical-profiles.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Answer:</span></span>
<span id="cb50-2"><a href="vertical-profiles.html#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># All bird densities will be a factor 10 times lower.</span></span></code></pre></div>
<p>The assumed radar cross section can be changed as follows:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="vertical-profiles.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s change the RCS to 110 cm^2</span></span>
<span id="cb51-2"><a href="vertical-profiles.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rcs</span>(my_vp) <span class="ot">&lt;-</span> <span class="dv">110</span></span></code></pre></div>
<p><strong>Exercise 6:</strong> Verify your answers on the previous two questions, by re-plotting the vertical profiles for the bird density quantity.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="vertical-profiles.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># After changing the RCS above, we simply plot the vertical profile again</span></span>
<span id="cb52-2"><a href="vertical-profiles.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vp)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="vertical-profiles.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the densities are scaled down by a factor 10</span></span></code></pre></div>
</div>
<div id="plotting-vertical-profile-time-series" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Plotting vertical profile time series<a href="vertical-profiles.html#plotting-vertical-profile-time-series" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will now examine multiple vertical profiles at once that are ordered into a time series, e.g. the vertical profiles obtained from a single radar over a full day.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="vertical-profiles.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert the list of vertical profiles into a time series:</span></span>
<span id="cb54-2"><a href="vertical-profiles.html#cb54-2" aria-hidden="true" tabindex="-1"></a>my_vpts <span class="ot">&lt;-</span> <span class="fu">bind_into_vpts</span>(my_vplist)</span>
<span id="cb54-3"><a href="vertical-profiles.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># time series objects can be subsetted, just as you may be used to with vectors</span></span>
<span id="cb54-4"><a href="vertical-profiles.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># here we subset the first 50 timesteps:</span></span>
<span id="cb54-5"><a href="vertical-profiles.html#cb54-5" aria-hidden="true" tabindex="-1"></a>my_vpts[<span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>]</span></code></pre></div>
<pre><code>##                    Irregular time series of vertical profiles (class vpts)
## 
##            radar:  KBRO 
##       # profiles:  50 
## time range (UTC):  2017-05-14 00:09:00 - 2017-05-14 06:54:00 
##    time step (s):  min: 300     max:  1740</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="vertical-profiles.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we extract a single timestep, which gives you back a vertical profile class object:</span></span>
<span id="cb56-2"><a href="vertical-profiles.html#cb56-2" aria-hidden="true" tabindex="-1"></a>my_vpts[<span class="dv">100</span>]</span></code></pre></div>
<pre><code>##                Vertical profile (class vp)
## 
##        radar:  KBRO 
##       source:  RAD:KBGM,PLC:Brownsville 
## nominal time:  2017-05-14 16:03:00 
## generated by:  vol2bird 0.3.17</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="vertical-profiles.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># to plot the full time series:</span></span>
<span id="cb58-2"><a href="vertical-profiles.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts)</span></code></pre></div>
<pre><code>## Warning in plot.vpts(my_vpts): Irregular time-series: missing profiles will not
## be visible. Use &#39;regularize_vpts&#39; to make time series regular.</code></pre>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="vertical-profiles.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check the help file for the plotting function of profile time series</span></span>
<span id="cb60-2"><a href="vertical-profiles.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Because profile timeseries are of class &#39;vpts&#39;, it&#39;s associated plotting function</span></span>
<span id="cb60-3"><a href="vertical-profiles.html#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># is called plot.vpts:</span></span>
<span id="cb60-4"><a href="vertical-profiles.html#cb60-4" aria-hidden="true" tabindex="-1"></a>?plot.vpts</span></code></pre></div>
<p>Let’s make a plot for a subselection (night only) of the time series:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="vertical-profiles.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># filter our vpts for night time</span></span>
<span id="cb61-2"><a href="vertical-profiles.html#cb61-2" aria-hidden="true" tabindex="-1"></a>my_vpts_night <span class="ot">&lt;-</span> <span class="fu">filter_vpts</span>(my_vpts, <span class="at">night=</span><span class="cn">TRUE</span>)</span>
<span id="cb61-3"><a href="vertical-profiles.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot this smaller time series:</span></span>
<span id="cb61-4"><a href="vertical-profiles.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts_night)</span></code></pre></div>
<pre><code>## Warning in plot.vpts(my_vpts_night): Irregular time-series: missing profiles
## will not be visible. Use &#39;regularize_vpts&#39; to make time series regular.</code></pre>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<p><strong>Exercise 7:</strong> Interpret the wind barbs in the profile time series figure: what is the approximate speed and direction at 1500 meter at 6 UTC? In the speed barbs, each half flag represents 2.5 m/s, each full flag 5 m/s, [each pennant (triangle) 25 m/s, not occurring in this case].</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="vertical-profiles.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Answer:</span></span>
<span id="cb63-2"><a href="vertical-profiles.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb63-3"><a href="vertical-profiles.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># At 1500 meter 6 UTC the wind barbs have 2 full flags and one half flag.</span></span>
<span id="cb63-4"><a href="vertical-profiles.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Therefore the ground speed is approximately 2x5 + 2.5 = 12.5 m/s.</span></span></code></pre></div>
<p><strong>Exercise 8:</strong> Extract the vertical profile at 6 UTC from the time series and plot the vertical profile of ground speed (quantity <code>ff</code>). Hint: use the <code>nearest</code> argument of function <code>filter_vpts()</code> to extract the 6 UTC profile. Check whether your answer to the previous question was approximately correct.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="vertical-profiles.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First extract the profile at 6 UTC:</span></span>
<span id="cb64-2"><a href="vertical-profiles.html#cb64-2" aria-hidden="true" tabindex="-1"></a>vp_6UTC <span class="ot">&lt;-</span> <span class="fu">filter_vpts</span>(my_vpts_night, <span class="at">nearest =</span> <span class="st">&quot;2017-05-14 06:00&quot;</span>)</span>
<span id="cb64-3"><a href="vertical-profiles.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vp_6UTC, <span class="at">quantity =</span> <span class="st">&quot;ff&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="vertical-profiles.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ground speed (ff):</span></span>
<span id="cb65-2"><a href="vertical-profiles.html#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vp_6UTC, <span class="at">quantity =</span> <span class="st">&quot;ff&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="vertical-profiles.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Speeds at 1500 metre is approximately 12 m/s, confirming our earlier reading above of 12.5 m/s.</span></span></code></pre></div>
</div>
<div id="vertical-and-time-integration-of-profiles" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Vertical and time integration of profiles<a href="vertical-profiles.html#vertical-and-time-integration-of-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often you will want to sum all the migrants across altitude, for example if you are interested in a single index of how many birds are migrating at a certain instant. There are at least two ways in which you can do that:</p>
<ul>
<li>by calculating the vertically integrated bird density (VID), which is <em>surface</em> density as opposed to a <em>volume</em> densities you have been plotting in the previous exercises: this number gives you how many migrants are aloft per square kilometer earth’s surface (unit individuals/km<span class="math inline">\(^{2}\)</span>), obtained by a vertical integration of the volume densities (unit individuals/km<span class="math inline">\(^{3}\)</span>).</li>
</ul>
<p><span class="math display">\[\textrm{VID}=\sum_{\textrm{height layers } i}{(\textrm{bird volume density})_i \times (\textrm{height layer thickness})_i}\]</span></p>
<ul>
<li>Note that the VID quantity doesn’t depend on the speed of the migrants. A common measure that reflects both the density and speed of the migration is migration traffic rate (MTR). This is flux measure that gives you how many migrants are passing the radar station per unit of time and per unit of distance perpendicular to the migratory direction (unit individuals/km/hour).</li>
</ul>
<p><span class="math display">\[\textrm{MTR}=\sum_{\textrm{height layers } i}{(\textrm{bird volume density})_i \times (\textrm{bird speed})_i \times (\textrm{height layer thickness})_i}\]</span></p>
<p>We will be using bioRad’s <code>integrate_profile()</code> function to calculate these quantities:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="vertical-profiles.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s continue with the vpts object created in the previous example.</span></span>
<span id="cb67-2"><a href="vertical-profiles.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The vertically integrated quantities are calculated as follows:</span></span>
<span id="cb67-3"><a href="vertical-profiles.html#cb67-3" aria-hidden="true" tabindex="-1"></a>my_vpi <span class="ot">&lt;-</span> <span class="fu">integrate_profile</span>(my_vpts)</span>
<span id="cb67-4"><a href="vertical-profiles.html#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The my_vpi object you created is a vpi class object, which is an acronym for &quot;vertical profile integrated&quot;. It has its own plot method, which by default plots migration traffic rate (MTR):</span></span>
<span id="cb67-5"><a href="vertical-profiles.html#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="vertical-profiles.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also plot vertically integrated densities (VID):</span></span>
<span id="cb68-2"><a href="vertical-profiles.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">quantity =</span> <span class="st">&quot;vid&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-30-2.png" width="672" /></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="vertical-profiles.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the gray and white shading indicates day and night, which is calculated</span></span>
<span id="cb69-2"><a href="vertical-profiles.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># from the date and the radar position. You can also turn this off:</span></span>
<span id="cb69-3"><a href="vertical-profiles.html#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">night_shade =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-30-3.png" width="672" /></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="vertical-profiles.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the cumulative number of birds passing the radar, i.e. migration traffic (mt):</span></span>
<span id="cb70-2"><a href="vertical-profiles.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">quantity =</span> <span class="st">&quot;mt&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-30-4.png" width="672" /></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="vertical-profiles.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># execute `?plot.vpi` to open the help page listing all the options.</span></span>
<span id="cb71-2"><a href="vertical-profiles.html#cb71-2" aria-hidden="true" tabindex="-1"></a>?plot.vpi</span></code></pre></div>
<p>Both MTR, VID and MT depend on the assumed radar cross section (RCS) per bird. If you are unwilling/unable to specify RCS, alternatively you can use of closely related quantities that make no assumptions RCS:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="vertical-profiles.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of vertically integrated density (VID), you can use vertically integrated reflectivity (VIR):</span></span>
<span id="cb72-2"><a href="vertical-profiles.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">quantity =</span> <span class="st">&quot;vir&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="vertical-profiles.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of migration traffic rate (MTR), you can use the reflectivity traffic rate (RTR):</span></span>
<span id="cb73-2"><a href="vertical-profiles.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">quantity =</span> <span class="st">&quot;rtr&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-31-2.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="vertical-profiles.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># instead of migration traffic (MT), you can use the reflectivity traffic (RT):</span></span>
<span id="cb74-2"><a href="vertical-profiles.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpi, <span class="at">quantity =</span> <span class="st">&quot;rt&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-31-3.png" width="672" /></p>
<p>VIR gives you the total cross-sectional area of air-borne targets per square kilometer of ground surface, whereas RTR gives you the total cross-sectional area of targets flying across a one kilometer line perpendicular to the migratory flow per hour.</p>
</div>
<div id="manipulating-vertical-profile-time-series-data" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Manipulating vertical profile time series data<a href="vertical-profiles.html#manipulating-vertical-profile-time-series-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You may sometimes want to manipulate <code>vpts</code> data using other well-known data manipulations tools, like the R package dplyr.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="vertical-profiles.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="vertical-profiles.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert vpts object to a data.frame:</span></span>
<span id="cb79-2"><a href="vertical-profiles.html#cb79-2" aria-hidden="true" tabindex="-1"></a>example_vpts <span class="sc">%&gt;%</span></span>
<span id="cb79-3"><a href="vertical-profiles.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="ot">-&gt;</span> my_df</span>
<span id="cb79-4"><a href="vertical-profiles.html#cb79-4" aria-hidden="true" tabindex="-1"></a>my_df</span></code></pre></div>
<pre><code>## # A tibble: 48,350 × 27
##    radar datetime            height      u      v      w     ff    dd sd_vvp
##    &lt;chr&gt; &lt;dttm&gt;               &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 KBGM  2016-09-01 00:02:00      0 NaN    NaN    NaN    NaN    NaN   NaN   
##  2 KBGM  2016-09-01 00:02:00    200 NaN    NaN    NaN    NaN    NaN   NaN   
##  3 KBGM  2016-09-01 00:02:00    400 NaN    NaN    NaN    NaN    NaN     2.81
##  4 KBGM  2016-09-01 00:02:00    600   4.14   3.84  12.2    5.65  47.2   2.8 
##  5 KBGM  2016-09-01 00:02:00    800   5.06   0.24  15.2    5.07  87.2   2.42
##  6 KBGM  2016-09-01 00:02:00   1000   4.74  -2.69  18.5    5.45 120.    2.38
##  7 KBGM  2016-09-01 00:02:00   1200   4.41  -4.09  -2.49   6.02 133.    2.29
##  8 KBGM  2016-09-01 00:02:00   1400   4.78  -3.55  -2.96   5.96 127.    2.34
##  9 KBGM  2016-09-01 00:02:00   1600   3.75  -3.03  -7.32   4.82 129.    2.62
## 10 KBGM  2016-09-01 00:02:00   1800   4.14  -2.03  -5.69   4.61 116.    3.06
## # ℹ 48,340 more rows
## # ℹ 18 more variables: gap &lt;lgl&gt;, dbz &lt;dbl&gt;, eta &lt;dbl&gt;, dens &lt;dbl&gt;, DBZH &lt;dbl&gt;,
## #   n &lt;int&gt;, n_dbz &lt;int&gt;, n_all &lt;int&gt;, n_dbz_all &lt;int&gt;, rcs &lt;dbl&gt;,
## #   sd_vvp_threshold &lt;dbl&gt;, radar_latitude &lt;dbl&gt;, radar_longitude &lt;dbl&gt;,
## #   radar_height &lt;dbl&gt;, radar_wavelength &lt;dbl&gt;, day &lt;lgl&gt;, sunrise &lt;dttm&gt;,
## #   sunset &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="vertical-profiles.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert data.frame back to vpts object:</span></span>
<span id="cb81-2"><a href="vertical-profiles.html#cb81-2" aria-hidden="true" tabindex="-1"></a>my_df <span class="sc">%&gt;%</span> <span class="fu">as.vpts</span>()</span></code></pre></div>
<pre><code>## Warning in validate_vpts(data): Extra fields found: day, sunrise, sunset</code></pre>
<pre><code>##                    Irregular time series of vertical profiles (class vpts)
## 
##            radar:  KBGM 
##       # profiles:  1934 
## time range (UTC):  2016-09-01 00:02:00 - 2016-09-10 11:56:00 
##    time step (s):  min: 180     max:  16320</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="vertical-profiles.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># as.vpts and as.data.frame (or as_tibble) work as each others inverse:</span></span>
<span id="cb84-2"><a href="vertical-profiles.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.vpts</span>(<span class="fu">as.data.frame</span>(example_vpts))</span></code></pre></div>
<pre><code>## Warning in validate_vpts(data): Extra fields found: day, sunrise, sunset</code></pre>
<pre><code>##                    Irregular time series of vertical profiles (class vpts)
## 
##            radar:  KBGM 
##       # profiles:  1934 
## time range (UTC):  2016-09-01 00:02:00 - 2016-09-10 11:56:00 
##    time step (s):  min: 180     max:  16320</code></pre>
<p>This allows for tidyverse style data manipulations. For example, let’s filter out data by height and date using package dplyr and plot it, using a single command:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="vertical-profiles.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb87-2"><a href="vertical-profiles.html#cb87-2" aria-hidden="true" tabindex="-1"></a>example_vpts <span class="sc">%&gt;%</span></span>
<span id="cb87-3"><a href="vertical-profiles.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert to data.frame, without adding sunrise/sunset columns</span></span>
<span id="cb87-4"><a href="vertical-profiles.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">suntime=</span><span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-5"><a href="vertical-profiles.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out heights layers above 1500 meter</span></span>
<span id="cb87-6"><a href="vertical-profiles.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(height <span class="sc">&lt;=</span> <span class="dv">1500</span>) <span class="sc">%&gt;%</span></span>
<span id="cb87-7"><a href="vertical-profiles.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter out data from Sep 4 - Sep 9</span></span>
<span id="cb87-8"><a href="vertical-profiles.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime <span class="sc">&lt;</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2016-09-04&quot;</span>,<span class="at">tz=</span><span class="st">&quot;UTC&quot;</span>) <span class="sc">|</span></span>
<span id="cb87-9"><a href="vertical-profiles.html#cb87-9" aria-hidden="true" tabindex="-1"></a>         datetime <span class="sc">&gt;</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2016-09-07&quot;</span>,<span class="at">tz=</span><span class="st">&quot;UTC&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb87-10"><a href="vertical-profiles.html#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert back to vpts object</span></span>
<span id="cb87-11"><a href="vertical-profiles.html#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vpts</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-12"><a href="vertical-profiles.html#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># regularize data on a regular time grid</span></span>
<span id="cb87-13"><a href="vertical-profiles.html#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (so we can visualize the data gap we created):</span></span>
<span id="cb87-14"><a href="vertical-profiles.html#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">regularize_vpts</span>() <span class="sc">%&gt;%</span></span>
<span id="cb87-15"><a href="vertical-profiles.html#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot the vertical profile time series</span></span>
<span id="cb87-16"><a href="vertical-profiles.html#cb87-16" aria-hidden="true" tabindex="-1"></a>  plot</span></code></pre></div>
<pre><code>## projecting on 300 seconds interval grid...</code></pre>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Or let us add a data column <code>high_speed</code> that indicates scatterers moving faster than 15 m/s, and plot that new data column in a profile plot:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="vertical-profiles.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb89-2"><a href="vertical-profiles.html#cb89-2" aria-hidden="true" tabindex="-1"></a>example_vpts <span class="sc">%&gt;%</span> </span>
<span id="cb89-3"><a href="vertical-profiles.html#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert vpts object to a data.frame:</span></span>
<span id="cb89-4"><a href="vertical-profiles.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="vertical-profiles.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add a data column that is TRUE (1) when the ground speed ff &gt; 15 m/s,</span></span>
<span id="cb89-6"><a href="vertical-profiles.html#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and FALSE (0) if it is slower or equal to 15 m/s:</span></span>
<span id="cb89-7"><a href="vertical-profiles.html#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">high_speed =</span> ff <span class="sc">&gt;</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="vertical-profiles.html#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convert back to vpts object:</span></span>
<span id="cb89-9"><a href="vertical-profiles.html#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.vpts</span>() <span class="sc">%&gt;%</span></span>
<span id="cb89-10"><a href="vertical-profiles.html#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot the new quantity:</span></span>
<span id="cb89-11"><a href="vertical-profiles.html#cb89-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(<span class="at">quantity=</span><span class="st">&quot;high_speed&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in validate_vpts(data): Extra fields found: day, sunrise, sunset,
## high_speed</code></pre>
<pre><code>## Warning in plot.vpts(., quantity = &quot;high_speed&quot;): Irregular time-series:
## missing profiles will not be visible. Use &#39;regularize_vpts&#39; to make time series
## regular.</code></pre>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Note that compatibility with the tidyverse remains under development, and critical data columns of vpts objects (like height) should not be removed.</p>
</div>
<div id="inspecting-precipitation-signals-in-profiles" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Inspecting precipitation signals in profiles<a href="vertical-profiles.html#inspecting-precipitation-signals-in-profiles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Precipitation is known to have a major influence on the timing and intensity of migration, therefore it is a useful skill to be able to inspect profiles for presence of precipitation.</p>
<p>Also, although automated bird quantification algorithms become more and more reliable, distinguishing precipitation from birds remains challenging for algorithms in specific cases. It is therefore important to have the skills to inspect suspicious profiles. That may help you to identify potential errors of the automated methods, and prevent your from overinterpreting the data.</p>
<p>An easy way of doing that is plotting the vertical profile of total reflectivity (quantity DBZH), which includes everything: birds, insects and precipitation. Precipitation often has higher reflectivities than birds, and also extends to much higher altitudes.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="vertical-profiles.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load a time series for the KBGM radar in Binghamton, NY</span></span>
<span id="cb92-2"><a href="vertical-profiles.html#cb92-2" aria-hidden="true" tabindex="-1"></a>my_vpts <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;data_vpts/KBGM20170527-20170602.rds&quot;</span>)</span>
<span id="cb92-3"><a href="vertical-profiles.html#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print the loaded vpts time series for this radar:</span></span>
<span id="cb92-4"><a href="vertical-profiles.html#cb92-4" aria-hidden="true" tabindex="-1"></a>my_vpts</span></code></pre></div>
<pre><code>##                    Regular time series of vertical profiles (class vpts)
## 
##            radar:  KBGM 
##       # profiles:  284 
## time range (UTC):  2017-05-27 08:31:00 - 2017-06-02 04:00:00 
##    time step (s):  1770</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="vertical-profiles.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the bird density over time:</span></span>
<span id="cb94-2"><a href="vertical-profiles.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts, <span class="at">quantity =</span> <span class="st">&quot;dens&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p><strong>Exercise 9:</strong> Compare the above plot for bird density (quantity <code>dens</code>) with a profile plot for total reflectivity (quantity <code>DBZH</code>, showing birds and precipitation combined). Compare the two plots to visually identify periods and altitude layers with precipitation.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="vertical-profiles.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># also show meteorological signals:</span></span>
<span id="cb95-2"><a href="vertical-profiles.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts, <span class="at">quantity =</span> <span class="st">&quot;DBZH&quot;</span>)</span></code></pre></div>
<p><img src="rad_aero_24_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="vertical-profiles.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Periods with high reflectivities extending to high altitudes indicate precipitation,</span></span>
<span id="cb96-2"><a href="vertical-profiles.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co"># i.e. second half of the second night, and on and off during the fourth night.</span></span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="screening-out-weather.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="range-bias-correction.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
