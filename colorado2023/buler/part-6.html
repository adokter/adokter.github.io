<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Part 6 | AW_2023_Working_with_low_tilt_data.knit</title>
  <meta name="description" content="Radar Aeroecology Workshop<br />
Working with low tilt data for mapping animals near the ground</div>" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Part 6 | AW_2023_Working_with_low_tilt_data.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Part 6 | AW_2023_Working_with_low_tilt_data.knit" />
  
  
  

<meta name="author" content="Includes R code written by Jeffrey Buler, Jaci Smolinsky, and Matt Boone, Department of Entomology and Wildlife Ecology, University of Delaware, Newark, DE, USA" />


<meta name="date" content="2023-07-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="part-5.html"/>
<link rel="next" href="part-7-on-your-own.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="part-1.html"><a href="part-1.html"><i class="fa fa-check"></i><b>1</b> Part 1</a>
<ul>
<li class="chapter" data-level="1.1" data-path="part-1.html"><a href="part-1.html#setup"><i class="fa fa-check"></i><b>1.1</b> Setup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="part-2.html"><a href="part-2.html"><i class="fa fa-check"></i><b>2</b> Part 2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="part-2.html"><a href="part-2.html#create-a-polygon-shapefile-basegrid-of-radar-sample-volumes"><i class="fa fa-check"></i><b>2.1</b> Create a polygon shapefile basegrid of radar sample volumes</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="part-3.html"><a href="part-3.html"><i class="fa fa-check"></i><b>3</b> Part 3</a>
<ul>
<li class="chapter" data-level="3.1" data-path="part-3.html"><a href="part-3.html#determine-ground-heights-underneath-sample-volumes"><i class="fa fa-check"></i><b>3.1</b> Determine ground heights underneath sample volumes</a></li>
<li class="chapter" data-level="3.2" data-path="part-3.html"><a href="part-3.html#load-basgrid-polygon-into-qgis---easy-way"><i class="fa fa-check"></i><b>3.2</b> Load basgrid polygon into QGIS - easy way</a></li>
<li class="chapter" data-level="3.3" data-path="part-3.html"><a href="part-3.html#changing-the-layer-properties-to-display-data"><i class="fa fa-check"></i><b>3.3</b> Changing the layer properties to display data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="part-4.html"><a href="part-4.html"><i class="fa fa-check"></i><b>4</b> Part 4</a>
<ul>
<li class="chapter" data-level="4.1" data-path="part-4.html"><a href="part-4.html#compute-topographic-beam-blockage"><i class="fa fa-check"></i><b>4.1</b> Compute topographic beam blockage</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="part-5.html"><a href="part-5.html"><i class="fa fa-check"></i><b>5</b> Part 5</a>
<ul>
<li class="chapter" data-level="5.1" data-path="part-5.html"><a href="part-5.html#examine-data-for-making-a-clutter-mask-for-the-basegrid"><i class="fa fa-check"></i><b>5.1</b> Examine data for making a clutter mask for the basegrid</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="part-5.html"><a href="part-5.html#join-table-to-layer-in-qgis"><i class="fa fa-check"></i><b>5.1.1</b> Join table to layer in QGIS</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="part-6.html"><a href="part-6.html"><i class="fa fa-check"></i><b>6</b> Part 6</a>
<ul>
<li class="chapter" data-level="6.1" data-path="part-6.html"><a href="part-6.html#estimating-beam-propagation-using-radiosonde-data"><i class="fa fa-check"></i><b>6.1</b> Estimating beam propagation using radiosonde data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="part-7-on-your-own.html"><a href="part-7-on-your-own.html"><i class="fa fa-check"></i><b>7</b> Part 7 (On your own)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="part-7-on-your-own.html"><a href="part-7-on-your-own.html#modeling-bird-stopover-distributions"><i class="fa fa-check"></i><b>7.1</b> Modeling bird stopover distributions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><div class="line-block">Radar Aeroecology Workshop<br />
Working with low tilt data for mapping animals near the ground</div></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="part-6" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Part 6<a href="part-6.html#part-6" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="estimating-beam-propagation-using-radiosonde-data" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Estimating beam propagation using radiosonde data<a href="part-6.html#estimating-beam-propagation-using-radiosonde-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When radiosonde data are available, it is often adventageous to calculate beam propagation given observed refractive conditions of the atmosphere. The following code allows you to do just that using standard radiosonde files archived here <a href="http://weather.uwyo.edu/upperair/sounding.html" class="uri">http://weather.uwyo.edu/upperair/sounding.html</a></p>
<p>Let’s read in several files from the KLWX radar station on different nights that were collected during the onset of nocturnal flight. The following code will chart the limits of the top and bottom of the beam as it travels out from the radar. The beam path using the observed atmospheric data (solid pink lines) is charted along with the beam path in a standard atmosphere (dashed black lines) with refraction following the 4/3 Earth radius model.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="part-6.html#cb15-1" tabindex="-1"></a><span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">list.files</span>(<span class="at">pattern=</span><span class="st">&quot;</span><span class="sc">\\</span><span class="st">.htm$&quot;</span>)){</span>
<span id="cb15-2"><a href="part-6.html#cb15-2" tabindex="-1"></a>  radio_n<span class="ot">&lt;-</span>j</span>
<span id="cb15-3"><a href="part-6.html#cb15-3" tabindex="-1"></a>date<span class="ot">&lt;-</span>((<span class="fu">substring</span>(radio_n,<span class="dv">6</span>,<span class="dv">13</span>)))</span>
<span id="cb15-4"><a href="part-6.html#cb15-4" tabindex="-1"></a><span class="co">#read in radiosonde</span></span>
<span id="cb15-5"><a href="part-6.html#cb15-5" tabindex="-1"></a>radio<span class="ot">&lt;-</span><span class="fu">read.fwf</span>(radio_n, <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>), <span class="at">sep=</span><span class="st">&quot;t&quot;</span>, <span class="at">skip=</span><span class="dv">10</span>, <span class="at">n=</span><span class="dv">50</span>, <span class="at">na.strings=</span><span class="fu">c</span>(<span class="st">&quot;       &quot;</span>))</span>
<span id="cb15-6"><a href="part-6.html#cb15-6" tabindex="-1"></a>  <span class="fu">colnames</span>(radio)<span class="ot">&lt;-</span><span class="fu">tolower</span>(<span class="fu">substr</span>(<span class="fu">t</span>(<span class="fu">read.fwf</span>(radio_n, <span class="at">widths=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>,<span class="dv">7</span>), <span class="at">sep=</span><span class="st">&quot;t&quot;</span>, <span class="at">skip=</span><span class="dv">7</span>,<span class="at">n=</span><span class="dv">1</span>)[<span class="dv">1</span>,]),<span class="dv">4</span>,<span class="dv">7</span>))</span>
<span id="cb15-7"><a href="part-6.html#cb15-7" tabindex="-1"></a>  radio<span class="ot">&lt;-</span><span class="fu">subset</span>(radio,<span class="sc">!</span><span class="fu">is.na</span>(temp))</span>
<span id="cb15-8"><a href="part-6.html#cb15-8" tabindex="-1"></a>  </span>
<span id="cb15-9"><a href="part-6.html#cb15-9" tabindex="-1"></a>  beamhtall<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">range=</span><span class="fu">numeric</span>(),<span class="at">bbeam=</span><span class="fu">numeric</span>(),<span class="at">mbeam=</span><span class="fu">numeric</span>(),<span class="at">tbeam=</span><span class="fu">numeric</span>(),<span class="at">elev=</span><span class="fu">numeric</span>())</span>
<span id="cb15-10"><a href="part-6.html#cb15-10" tabindex="-1"></a><span class="do">###calculate refraction</span></span>
<span id="cb15-11"><a href="part-6.html#cb15-11" tabindex="-1"></a>  radio<span class="sc">$</span>hght[radio<span class="sc">$</span>hght<span class="sc">&lt;=</span><span class="dv">0</span>]<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb15-12"><a href="part-6.html#cb15-12" tabindex="-1"></a>  radio<span class="ot">&lt;-</span>radio[radio<span class="sc">$</span>hght<span class="sc">&gt;=</span><span class="dv">0</span>,]</span>
<span id="cb15-13"><a href="part-6.html#cb15-13" tabindex="-1"></a>  </span>
<span id="cb15-14"><a href="part-6.html#cb15-14" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">min</span>(radio<span class="sc">$</span>hght)<span class="sc">&lt;</span>antht) {radio<span class="ot">&lt;-</span>radio[<span class="fu">max</span>(<span class="fu">which</span>(radio<span class="sc">$</span>hght<span class="sc">&lt;</span>antht))<span class="sc">:</span><span class="fu">nrow</span>(radio),]}</span>
<span id="cb15-15"><a href="part-6.html#cb15-15" tabindex="-1"></a>  radio<span class="ot">&lt;-</span><span class="fu">aggregate</span>(radio,<span class="at">by=</span><span class="fu">list</span>(radio<span class="sc">$</span>hght),mean)[,<span class="dv">2</span><span class="sc">:</span><span class="fu">ncol</span>(radio)]</span>
<span id="cb15-16"><a href="part-6.html#cb15-16" tabindex="-1"></a>  </span>
<span id="cb15-17"><a href="part-6.html#cb15-17" tabindex="-1"></a>  radio<span class="sc">$</span>watervapor<span class="ot">&lt;-</span><span class="fl">6.1078</span><span class="sc">*</span><span class="dv">10</span><span class="sc">**</span>((radio<span class="sc">$</span>dwpt<span class="sc">*</span><span class="fl">7.5</span>)<span class="sc">/</span>(radio<span class="sc">$</span>dwpt<span class="fl">+237.3</span>))</span>
<span id="cb15-18"><a href="part-6.html#cb15-18" tabindex="-1"></a>  radio<span class="sc">$</span>refractivity <span class="ot">&lt;-</span> (<span class="fl">77.6</span><span class="sc">/</span>(radio<span class="sc">$</span>temp<span class="fl">+273.18</span>))<span class="sc">*</span>(radio<span class="sc">$</span>pres<span class="sc">+</span>(<span class="dv">4810</span><span class="sc">*</span>(radio<span class="sc">$</span>watervapor<span class="sc">/</span>(radio<span class="sc">$</span>temp<span class="fl">+273.18</span>))))</span>
<span id="cb15-19"><a href="part-6.html#cb15-19" tabindex="-1"></a>  radio<span class="sc">$</span>n<span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">+</span>(radio<span class="sc">$</span>refractivity<span class="sc">/</span><span class="dv">1000000</span>)</span>
<span id="cb15-20"><a href="part-6.html#cb15-20" tabindex="-1"></a>  n1<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,radio<span class="sc">$</span>n[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(radio)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb15-21"><a href="part-6.html#cb15-21" tabindex="-1"></a>  radio<span class="sc">$</span>hght[radio<span class="sc">$</span>hght<span class="sc">==</span>antht]<span class="ot">&lt;-</span>radio<span class="sc">$</span>hght[radio<span class="sc">$</span>hght<span class="sc">==</span>antht]<span class="sc">-</span><span class="dv">1</span></span>
<span id="cb15-22"><a href="part-6.html#cb15-22" tabindex="-1"></a>  radio<span class="sc">$</span>heightb<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,radio<span class="sc">$</span>hght[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(radio)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb15-23"><a href="part-6.html#cb15-23" tabindex="-1"></a>  radio<span class="sc">$</span>refindex<span class="ot">&lt;-</span>(radio<span class="sc">$</span>n<span class="sc">-</span>n1)<span class="sc">/</span>((radio<span class="sc">$</span>hght<span class="sc">-</span>radio<span class="sc">$</span>heightb)<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb15-24"><a href="part-6.html#cb15-24" tabindex="-1"></a>  radio<span class="sc">$</span>theta<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-25"><a href="part-6.html#cb15-25" tabindex="-1"></a>  radio<span class="sc">$</span>arcdist<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb15-26"><a href="part-6.html#cb15-26" tabindex="-1"></a>  radio<span class="sc">$</span>a<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-27"><a href="part-6.html#cb15-27" tabindex="-1"></a>  radio<span class="sc">$</span>k<span class="ot">&lt;-</span><span class="cn">NA</span></span>
<span id="cb15-28"><a href="part-6.html#cb15-28" tabindex="-1"></a>  radio<span class="ot">&lt;-</span>radio[<span class="sc">!</span><span class="fu">is.na</span>(radio<span class="sc">$</span>n),]</span>
<span id="cb15-29"><a href="part-6.html#cb15-29" tabindex="-1"></a> </span>
<span id="cb15-30"><a href="part-6.html#cb15-30" tabindex="-1"></a>elev<span class="ot">&lt;-</span><span class="fl">0.50</span> <span class="co">#tilt angle of beam</span></span>
<span id="cb15-31"><a href="part-6.html#cb15-31" tabindex="-1"></a>range<span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1</span>, <span class="at">to=</span>  <span class="dv">100</span>, <span class="at">by =</span><span class="fl">0.5</span>)</span>
<span id="cb15-32"><a href="part-6.html#cb15-32" tabindex="-1"></a>beamhtall<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">range=</span>range,<span class="at">bbeam=</span><span class="cn">NA</span>,<span class="at">mbeam=</span><span class="cn">NA</span>,<span class="at">tbeam=</span><span class="cn">NA</span>,<span class="at">elev=</span>elev)</span>
<span id="cb15-33"><a href="part-6.html#cb15-33" tabindex="-1"></a>    <span class="co">#propagate top, middle, and bottom of beam</span></span>
<span id="cb15-34"><a href="part-6.html#cb15-34" tabindex="-1"></a>    <span class="cf">for</span>(beam <span class="cf">in</span> <span class="fu">c</span>(elev<span class="sc">*</span>DEG2RAD<span class="sc">-</span>halfbeam,elev<span class="sc">*</span>DEG2RAD,elev<span class="sc">*</span>DEG2RAD<span class="sc">+</span>halfbeam)){</span>
<span id="cb15-35"><a href="part-6.html#cb15-35" tabindex="-1"></a>      <span class="co">#beam&lt;-elev*DEG2RAD-halfbeam ###only for test purposes</span></span>
<span id="cb15-36"><a href="part-6.html#cb15-36" tabindex="-1"></a>      mom<span class="ot">&lt;-</span><span class="fu">which</span>(beam<span class="sc">==</span><span class="fu">c</span>(elev<span class="sc">*</span>DEG2RAD<span class="sc">-</span>halfbeam,elev<span class="sc">*</span>DEG2RAD,elev<span class="sc">*</span>DEG2RAD<span class="sc">+</span>halfbeam))</span>
<span id="cb15-37"><a href="part-6.html#cb15-37" tabindex="-1"></a>      radioframe<span class="ot">&lt;-</span>radio</span>
<span id="cb15-38"><a href="part-6.html#cb15-38" tabindex="-1"></a>      <span class="do">####if height&lt;antht</span></span>
<span id="cb15-39"><a href="part-6.html#cb15-39" tabindex="-1"></a>      radioframe<span class="sc">$</span>a[radioframe<span class="sc">$</span>hght<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span>(eartha<span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb15-40"><a href="part-6.html#cb15-40" tabindex="-1"></a>      radioframe<span class="sc">$</span>theta[radioframe<span class="sc">$</span>hght<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span>((beam)) <span class="do">###dependent on part of beam</span></span>
<span id="cb15-41"><a href="part-6.html#cb15-41" tabindex="-1"></a>      radioframe<span class="sc">$</span>thickness[radioframe<span class="sc">$</span>hght<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-42"><a href="part-6.html#cb15-42" tabindex="-1"></a>      radioframe<span class="sc">$</span>arcdist[radioframe<span class="sc">$</span>hght<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-43"><a href="part-6.html#cb15-43" tabindex="-1"></a>      </span>
<span id="cb15-44"><a href="part-6.html#cb15-44" tabindex="-1"></a>      <span class="do">####if heightb&lt;antht</span></span>
<span id="cb15-45"><a href="part-6.html#cb15-45" tabindex="-1"></a>      radioframe<span class="sc">$</span>thickness[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht <span class="sc">&amp;</span> radioframe<span class="sc">$</span>heightb<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span>(radioframe<span class="sc">$</span>hght[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht <span class="sc">&amp;</span> radioframe<span class="sc">$</span>heightb<span class="sc">&lt;</span>antht]<span class="sc">-</span>antht)<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb15-46"><a href="part-6.html#cb15-46" tabindex="-1"></a>      radioframe<span class="sc">$</span>theta[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht <span class="sc">&amp;</span> radioframe<span class="sc">$</span>heightb<span class="sc">&lt;</span>antht]<span class="ot">&lt;-</span>(beam)</span>
<span id="cb15-47"><a href="part-6.html#cb15-47" tabindex="-1"></a>      </span>
<span id="cb15-48"><a href="part-6.html#cb15-48" tabindex="-1"></a>      <span class="do">####otherwise</span></span>
<span id="cb15-49"><a href="part-6.html#cb15-49" tabindex="-1"></a>      radioframe<span class="sc">$</span>thickness[radioframe<span class="sc">$</span>heightb<span class="sc">&gt;</span>antht]<span class="ot">&lt;-</span>(radioframe<span class="sc">$</span>hght[radioframe<span class="sc">$</span>heightb<span class="sc">&gt;</span>antht]<span class="sc">-</span>radioframe<span class="sc">$</span>heightb[radioframe<span class="sc">$</span>heightb<span class="sc">&gt;</span>antht])<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb15-50"><a href="part-6.html#cb15-50" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">min</span>(radioframe<span class="sc">$</span>hght)<span class="sc">&lt;</span>antht) {radioframe<span class="sc">$</span>a<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rep</span>(eartha<span class="sc">/</span><span class="dv">1000</span>,<span class="fu">max</span>(<span class="fu">which</span>(<span class="sc">!</span>(radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht)))),eartha<span class="sc">/</span><span class="dv">1000</span><span class="sc">+</span><span class="fu">cumsum</span>(radioframe<span class="sc">$</span>thickness)[<span class="fu">which</span>(radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht)<span class="sc">-</span><span class="dv">1</span>])}</span>
<span id="cb15-51"><a href="part-6.html#cb15-51" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">min</span>(radioframe<span class="sc">$</span>hght)<span class="sc">&gt;=</span>antht) {radioframe<span class="sc">$</span>a<span class="ot">&lt;-</span><span class="fu">c</span>(eartha<span class="sc">/</span><span class="dv">1000</span>,eartha<span class="sc">/</span><span class="dv">1000</span><span class="sc">+</span><span class="fu">cumsum</span>(radioframe<span class="sc">$</span>thickness)[<span class="fu">which</span>(radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht)<span class="sc">-</span><span class="dv">1</span>])}</span>
<span id="cb15-52"><a href="part-6.html#cb15-52" tabindex="-1"></a>      </span>
<span id="cb15-53"><a href="part-6.html#cb15-53" tabindex="-1"></a>      a1<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,radioframe<span class="sc">$</span>a[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(radioframe)<span class="sc">-</span><span class="dv">1</span>])  <span class="do">###lag a</span></span>
<span id="cb15-54"><a href="part-6.html#cb15-54" tabindex="-1"></a>      radioframe<span class="sc">$</span>thetap[a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>)]<span class="ot">&lt;-</span><span class="fu">asin</span>(<span class="fu">sqrt</span>((<span class="sc">-</span><span class="dv">2</span>)<span class="sc">*</span>(radioframe<span class="sc">$</span>thickness[a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>)])<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(radioframe<span class="sc">$</span>refindex[a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>)]<span class="sc">*</span>a1[a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>)]))<span class="sc">/</span>(a1[a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>)])))</span>
<span id="cb15-55"><a href="part-6.html#cb15-55" tabindex="-1"></a>      radioframe<span class="sc">$</span>thetap[<span class="sc">!</span>(a1<span class="sc">*</span>radioframe<span class="sc">$</span>refindex<span class="sc">&lt;=</span>(<span class="sc">-</span><span class="dv">1</span>))<span class="sc">&amp;</span>radioframe<span class="sc">$</span>heightb<span class="sc">&gt;</span>antht]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-56"><a href="part-6.html#cb15-56" tabindex="-1"></a>      </span>
<span id="cb15-57"><a href="part-6.html#cb15-57" tabindex="-1"></a>      <span class="do">###more otherwise</span></span>
<span id="cb15-58"><a href="part-6.html#cb15-58" tabindex="-1"></a>      rt<span class="ot">&lt;-</span><span class="fu">which</span>(radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht) </span>
<span id="cb15-59"><a href="part-6.html#cb15-59" tabindex="-1"></a>      </span>
<span id="cb15-60"><a href="part-6.html#cb15-60" tabindex="-1"></a>      <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">which</span>(radioframe<span class="sc">$</span>heightb<span class="sc">&gt;</span>antht)){  radioframe<span class="sc">$</span>theta[i]<span class="ot">&lt;-</span><span class="fu">atan</span>(<span class="fu">sqrt</span>((((radioframe<span class="sc">$</span>a[i<span class="dv">-1</span>])<span class="sc">*</span><span class="fu">sin</span>(radioframe<span class="sc">$</span>theta[i<span class="dv">-1</span>]))<span class="sc">**</span><span class="dv">2</span>)<span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span>radioframe<span class="sc">$</span>a[i<span class="dv">-1</span>]<span class="sc">*</span>(radioframe<span class="sc">$</span>thickness[i<span class="dv">-1</span>])<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(radioframe<span class="sc">$</span>refindex[i<span class="dv">-1</span>]<span class="sc">*</span>radioframe<span class="sc">$</span>a[i<span class="dv">-1</span>]))))<span class="sc">/</span>radioframe<span class="sc">$</span>a[i<span class="dv">-1</span>]<span class="sc">*</span><span class="fu">cos</span>(radioframe<span class="sc">$</span>theta[i<span class="dv">-1</span>]))}</span>
<span id="cb15-61"><a href="part-6.html#cb15-61" tabindex="-1"></a>      </span>
<span id="cb15-62"><a href="part-6.html#cb15-62" tabindex="-1"></a>      radioframe<span class="sc">$</span>arcdist[rt]<span class="ot">&lt;-</span>(<span class="fu">cos</span>(radioframe<span class="sc">$</span>theta[rt])<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>(radioframe<span class="sc">$</span>refindex[rt]<span class="sc">*</span>radioframe<span class="sc">$</span>a[rt])))<span class="sc">*</span>(<span class="fu">sqrt</span>(((radioframe<span class="sc">$</span>a[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht]<span class="sc">*</span><span class="fu">sin</span>(radioframe<span class="sc">$</span>theta[rt]))<span class="sc">**</span><span class="dv">2</span>)<span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span>radioframe<span class="sc">$</span>a[rt]<span class="sc">*</span>(<span class="dv">1</span><span class="sc">+</span>(radioframe<span class="sc">$</span>refindex[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht]<span class="sc">*</span>a1[rt]))<span class="sc">*</span>radioframe<span class="sc">$</span>thickness[rt]))<span class="sc">-</span>(a1[rt]<span class="sc">*</span><span class="fu">sin</span>(radioframe<span class="sc">$</span>theta[rt])))</span>
<span id="cb15-63"><a href="part-6.html#cb15-63" tabindex="-1"></a>      radioframe<span class="sc">$</span>arcdist[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap]<span class="ot">&lt;-</span><span class="dv">2</span><span class="sc">*</span>((<span class="sc">-</span>radioframe<span class="sc">$</span>a[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap]<span class="sc">*</span><span class="fu">cos</span>(radioframe<span class="sc">$</span>theta[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap])<span class="sc">*</span><span class="fu">sin</span>(radioframe<span class="sc">$</span>theta[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap]))<span class="sc">/</span>((radioframe<span class="sc">$</span>refindex[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap]<span class="sc">*</span>radioframe<span class="sc">$</span>a[radioframe<span class="sc">$</span>thetap<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">&amp;</span> radioframe<span class="sc">$</span>t1<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>thetap])<span class="sc">+</span><span class="dv">1</span>))</span>
<span id="cb15-64"><a href="part-6.html#cb15-64" tabindex="-1"></a>      radioframe<span class="sc">$</span>k[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht]<span class="ot">&lt;-</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>(a1[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht]<span class="sc">*</span>radioframe<span class="sc">$</span>refindex[radioframe<span class="sc">$</span>hght<span class="sc">&gt;</span>antht])))</span>
<span id="cb15-65"><a href="part-6.html#cb15-65" tabindex="-1"></a>      </span>
<span id="cb15-66"><a href="part-6.html#cb15-66" tabindex="-1"></a>      <span class="do">###############################################################</span></span>
<span id="cb15-67"><a href="part-6.html#cb15-67" tabindex="-1"></a>      <span class="do">####make ranges####</span></span>
<span id="cb15-68"><a href="part-6.html#cb15-68" tabindex="-1"></a>      </span>
<span id="cb15-69"><a href="part-6.html#cb15-69" tabindex="-1"></a>      radioframe<span class="sc">$</span>cumrange<span class="ot">&lt;-</span><span class="fu">cumsum</span>(radioframe<span class="sc">$</span>arcdist)</span>
<span id="cb15-70"><a href="part-6.html#cb15-70" tabindex="-1"></a>      radioframe<span class="sc">$</span>prevrange<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">cumsum</span>(radioframe<span class="sc">$</span>arcdist)[<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(radioframe)<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb15-71"><a href="part-6.html#cb15-71" tabindex="-1"></a>      radioframe<span class="sc">$</span>prevrange[<span class="fu">is.na</span>(radioframe<span class="sc">$</span>prevrange)]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb15-72"><a href="part-6.html#cb15-72" tabindex="-1"></a>      </span>
<span id="cb15-73"><a href="part-6.html#cb15-73" tabindex="-1"></a>      <span class="do">##############################################################</span></span>
<span id="cb15-74"><a href="part-6.html#cb15-74" tabindex="-1"></a>      <span class="do">####now we&#39;re creating beam heights</span></span>
<span id="cb15-75"><a href="part-6.html#cb15-75" tabindex="-1"></a>      bb<span class="ot">&lt;-</span>radioframe[<span class="fu">sapply</span>(range,<span class="cf">function</span>(x){<span class="fu">min</span>(<span class="fu">which</span>(x<span class="sc">&lt;=</span>radioframe<span class="sc">$</span>cumrange))}),]</span>
<span id="cb15-76"><a href="part-6.html#cb15-76" tabindex="-1"></a>      bb<span class="sc">$</span>range<span class="ot">&lt;-</span>range</span>
<span id="cb15-77"><a href="part-6.html#cb15-77" tabindex="-1"></a>      bb<span class="sc">$</span>relrange<span class="ot">&lt;-</span>bb<span class="sc">$</span>range<span class="sc">-</span>bb<span class="sc">$</span>prevrange</span>
<span id="cb15-78"><a href="part-6.html#cb15-78" tabindex="-1"></a>      beamhtall[,<span class="dv">1</span><span class="sc">+</span>mom]<span class="ot">&lt;-</span>bb<span class="sc">$</span>k<span class="sc">*</span>bb<span class="sc">$</span>a<span class="sc">*</span>((<span class="fu">cos</span>(bb<span class="sc">$</span>theta)<span class="sc">/</span><span class="fu">cos</span>(bb<span class="sc">$</span>theta<span class="sc">+</span>(bb<span class="sc">$</span>relrange<span class="sc">/</span>(bb<span class="sc">$</span>k<span class="sc">*</span>bb<span class="sc">$</span>a))))<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span><span class="dv">1000</span><span class="sc">+</span>(bb<span class="sc">$</span>hght<span class="sc">-</span>(bb<span class="sc">$</span>thickness<span class="sc">*</span><span class="dv">1000</span>))</span>
<span id="cb15-79"><a href="part-6.html#cb15-79" tabindex="-1"></a>      </span>
<span id="cb15-80"><a href="part-6.html#cb15-80" tabindex="-1"></a>    }<span class="do">###end beam loop</span></span>
<span id="cb15-81"><a href="part-6.html#cb15-81" tabindex="-1"></a></span>
<span id="cb15-82"><a href="part-6.html#cb15-82" tabindex="-1"></a></span>
<span id="cb15-83"><a href="part-6.html#cb15-83" tabindex="-1"></a>beamhtall<span class="ot">&lt;-</span><span class="fu">na.replace</span>(beamhtall, <span class="dv">0</span>)</span>
<span id="cb15-84"><a href="part-6.html#cb15-84" tabindex="-1"></a></span>
<span id="cb15-85"><a href="part-6.html#cb15-85" tabindex="-1"></a></span>
<span id="cb15-86"><a href="part-6.html#cb15-86" tabindex="-1"></a><span class="co">#   calculate beamht for standard atmosphere</span></span>
<span id="cb15-87"><a href="part-6.html#cb15-87" tabindex="-1"></a>beamhtallstd<span class="ot">&lt;-</span><span class="fu">beamht_std</span>(<span class="at">range=</span>range<span class="sc">*</span><span class="dv">1000</span>, <span class="at">antht=</span>antht, <span class="at">theta=</span>elev, <span class="at">earthr=</span>earthr)</span>
<span id="cb15-88"><a href="part-6.html#cb15-88" tabindex="-1"></a></span>
<span id="cb15-89"><a href="part-6.html#cb15-89" tabindex="-1"></a><span class="co">#   plot beamhtall (radiosonde) and beamhtstd (w/o radiosonde) to compare</span></span>
<span id="cb15-90"><a href="part-6.html#cb15-90" tabindex="-1"></a><span class="fu">plot</span>(beamhtall<span class="sc">$</span>range,beamhtall<span class="sc">$</span>bbeam,<span class="at">type=</span><span class="st">&quot;l&quot;</span>,<span class="at">col=</span><span class="st">&quot;hotpink&quot;</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(beamhtall<span class="sc">$</span>tbeam)),<span class="at">main=</span><span class="fu">paste0</span>(<span class="st">&quot;Beam limits on &quot;</span>,date),<span class="at">xlab=</span><span class="st">&quot;Range (km)&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Height ASL (m)&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>)  </span>
<span id="cb15-91"><a href="part-6.html#cb15-91" tabindex="-1"></a><span class="fu">lines</span>(beamhtallstd<span class="sc">$</span>range<span class="sc">/</span><span class="dv">1000</span>,beamhtallstd<span class="sc">$</span>bbeam, <span class="at">lty=</span><span class="dv">2</span>)   </span>
<span id="cb15-92"><a href="part-6.html#cb15-92" tabindex="-1"></a><span class="fu">lines</span>(beamhtall<span class="sc">$</span>range,beamhtall<span class="sc">$</span>tbeam,<span class="at">col=</span><span class="st">&quot;hotpink&quot;</span>)   </span>
<span id="cb15-93"><a href="part-6.html#cb15-93" tabindex="-1"></a><span class="fu">lines</span>(beamhtallstd<span class="sc">$</span>range<span class="sc">/</span><span class="dv">1000</span>,beamhtallstd<span class="sc">$</span>tbeam, <span class="at">lty=</span><span class="dv">2</span>)   </span>
<span id="cb15-94"><a href="part-6.html#cb15-94" tabindex="-1"></a><span class="fu">legend</span>(<span class="dv">1</span>, <span class="dv">2000</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Observed atmosphere&quot;</span>, <span class="st">&quot;Standard atmosphere&quot;</span>),</span>
<span id="cb15-95"><a href="part-6.html#cb15-95" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;hotpink&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">cex=</span><span class="fl">0.8</span>)</span>
<span id="cb15-96"><a href="part-6.html#cb15-96" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="AW_2023_Working_with_low_tilt_data_files/figure-html/unnamed-chunk-9-1.png" width="672" /><img src="AW_2023_Working_with_low_tilt_data_files/figure-html/unnamed-chunk-9-2.png" width="672" /><img src="AW_2023_Working_with_low_tilt_data_files/figure-html/unnamed-chunk-9-3.png" width="672" /><img src="AW_2023_Working_with_low_tilt_data_files/figure-html/unnamed-chunk-9-4.png" width="672" /><img src="AW_2023_Working_with_low_tilt_data_files/figure-html/unnamed-chunk-9-5.png" width="672" /></p>
<div id="which-night-had-the-strongest-refraction-of-the-radar-beam" class="section level4 hasAnchor" number="6.1.0.1">
<h4><span class="header-section-number">6.1.0.1</span> Which night had the strongest refraction of the radar beam?<a href="part-6.html#which-night-had-the-strongest-refraction-of-the-radar-beam" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Note that when the bottom beam limit is at 0 m ASL, the beam is intercepting the ground. This would represent a case of severe refraction deemed anomalous propagation.</p>
</div>
<div id="try-modeling-the-beam-refraction-at-a-higher-tilt-angle.-are-the-effects-of-refraction-stronger-or-weaker-why" class="section level4 hasAnchor" number="6.1.0.2">
<h4><span class="header-section-number">6.1.0.2</span> Try modeling the beam refraction at a higher tilt angle. Are the effects of refraction stronger or weaker? Why?<a href="part-6.html#try-modeling-the-beam-refraction-at-a-higher-tilt-angle.-are-the-effects-of-refraction-stronger-or-weaker-why" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="part-5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="part-7-on-your-own.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
