<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Processing many polar volumes | Introductory exercises with bioRad</title>
  <meta name="description" content="6 Processing many polar volumes | Introductory exercises with bioRad" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Processing many polar volumes | Introductory exercises with bioRad" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Processing many polar volumes | Introductory exercises with bioRad" />
  
  
  

<meta name="author" content="Adriaan M. Dokter" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="range-bias-correction.html"/>
<link rel="next" href="further-analysis-outside-biorad.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting started</a></li>
<li class="chapter" data-level="2" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html"><i class="fa fa-check"></i><b>2</b> Basic visualization of radar scans</a>
<ul>
<li class="chapter" data-level="2.1" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#the-structure-of-polar-volumes"><i class="fa fa-check"></i><b>2.1</b> The structure of polar volumes</a></li>
<li class="chapter" data-level="2.2" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#plotting-radar-scans"><i class="fa fa-check"></i><b>2.2</b> Plotting radar scans</a></li>
<li class="chapter" data-level="2.3" data-path="basic-visualization-of-radar-scans.html"><a href="basic-visualization-of-radar-scans.html#overlaying-radar-scans-on-maps"><i class="fa fa-check"></i><b>2.3</b> Overlaying radar scans on maps</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="screening-out-weather.html"><a href="screening-out-weather.html"><i class="fa fa-check"></i><b>3</b> Screening out weather</a>
<ul>
<li class="chapter" data-level="3.1" data-path="screening-out-weather.html"><a href="screening-out-weather.html#using-correlation-coefficient"><i class="fa fa-check"></i><b>3.1</b> using correlation coefficient</a></li>
<li class="chapter" data-level="3.2" data-path="screening-out-weather.html"><a href="screening-out-weather.html#using-mistnet"><i class="fa fa-check"></i><b>3.2</b> using MistNet</a></li>
<li class="chapter" data-level="3.3" data-path="screening-out-weather.html"><a href="screening-out-weather.html#using-depolarization-ratio"><i class="fa fa-check"></i><b>3.3</b> using depolarization ratio</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="vertical-profiles.html"><a href="vertical-profiles.html"><i class="fa fa-check"></i><b>4</b> Vertical profiles</a>
<ul>
<li class="chapter" data-level="4.1" data-path="vertical-profiles.html"><a href="vertical-profiles.html#loading-processed-vertical-profiles"><i class="fa fa-check"></i><b>4.1</b> Loading processed vertical profiles</a></li>
<li class="chapter" data-level="4.2" data-path="vertical-profiles.html"><a href="vertical-profiles.html#inspecting-single-vertical-profiles"><i class="fa fa-check"></i><b>4.2</b> Inspecting single vertical profiles</a></li>
<li class="chapter" data-level="4.3" data-path="vertical-profiles.html"><a href="vertical-profiles.html#plotting-vertical-profile-time-series"><i class="fa fa-check"></i><b>4.3</b> Plotting vertical profile time series</a></li>
<li class="chapter" data-level="4.4" data-path="vertical-profiles.html"><a href="vertical-profiles.html#vertical-and-time-integration-of-profiles"><i class="fa fa-check"></i><b>4.4</b> Vertical and time integration of profiles</a></li>
<li class="chapter" data-level="4.5" data-path="vertical-profiles.html"><a href="vertical-profiles.html#manipulating-vertical-profile-time-series-data"><i class="fa fa-check"></i><b>4.5</b> Manipulating vertical profile time series data</a></li>
<li class="chapter" data-level="4.6" data-path="vertical-profiles.html"><a href="vertical-profiles.html#inspecting-precipitation-signals-in-profiles"><i class="fa fa-check"></i><b>4.6</b> Inspecting precipitation signals in profiles</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="range-bias-correction.html"><a href="range-bias-correction.html"><i class="fa fa-check"></i><b>5</b> Range bias correction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="range-bias-correction.html"><a href="range-bias-correction.html#processing-a-polar-volume-into-a-profile"><i class="fa fa-check"></i><b>5.1</b> Processing a polar volume into a profile</a></li>
<li class="chapter" data-level="5.2" data-path="range-bias-correction.html"><a href="range-bias-correction.html#range-bias-correction-and-vertical-integration-on-a-map"><i class="fa fa-check"></i><b>5.2</b> Range bias correction and vertical integration on a map</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html"><i class="fa fa-check"></i><b>6</b> Processing many polar volumes</a>
<ul>
<li class="chapter" data-level="6.1" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#accessing-radar-data"><i class="fa fa-check"></i><b>6.1</b> Accessing radar data</a></li>
<li class="chapter" data-level="6.2" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#processing-multiple-polar-volumes"><i class="fa fa-check"></i><b>6.2</b> Processing multiple polar volumes</a></li>
<li class="chapter" data-level="6.3" data-path="processing-many-polar-volumes.html"><a href="processing-many-polar-volumes.html#parallel-processing"><i class="fa fa-check"></i><b>6.3</b> Parallel processing</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="further-analysis-outside-biorad.html"><a href="further-analysis-outside-biorad.html"><i class="fa fa-check"></i><b>7</b> Further analysis outside bioRad</a></li>
<li class="chapter" data-level="8" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>8</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="8.1" data-path="troubleshooting.html"><a href="troubleshooting.html#cannot-find-proj.db"><i class="fa fa-check"></i><b>8.1</b> Cannot find proj.db</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introductory exercises with bioRad</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="processing-many-polar-volumes" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Processing many polar volumes<a href="processing-many-polar-volumes.html#processing-many-polar-volumes" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="accessing-radar-data" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Accessing radar data<a href="processing-many-polar-volumes.html#accessing-radar-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>US NEXRAD polar volume data can be accessed in the <a href="https://s3.amazonaws.com/noaa-nexrad-level2/index.html">Amazon cloud</a>. Use function <code>download_pvolfiles()</code> for local downloads</li>
<li>European radar data can be accessed at <a href="https://aloftdata.eu" class="uri">https://aloftdata.eu</a>. These are processed vertical profiles, the full polar volume data are not openly available for most countries. Data are available for single profiles (vp) in ODIM h5 format, or as monthly vertical profile time series (vpts) in <a href="https://aloftdata.eu/vpts-csv/">VPTS CSV</a> format.</li>
<li>Use function <code>download_vpfiles()</code> for local vp downloads, or manually download monthly vpts files that can be read with <code>read_vpts()</code>.</li>
</ul>
<p>The names of the radars in the networks can be found here:</p>
<ul>
<li>US: <a href="https://www.roc.noaa.gov/WSR88D/Maps.aspx">NEXRAD network</a></li>
<li>Europe: <a href="http://eumetnet.eu/wp-content/themes/aeron-child/observations-programme/current-activities/opera/database/OPERA_Database/index.html">OPERA database</a></li>
</ul>
<p>Useful sites for inspecting pre-made movies of the US composite are <a href="https://birdcast.info/migration-tools/live-migration-maps/" class="uri">https://birdcast.info/migration-tools/live-migration-maps/</a> and <a href="https://www.pauljhurtado.com/US_Composite_Radar/" class="uri">https://www.pauljhurtado.com/US_Composite_Radar/</a>.</p>
</div>
<div id="processing-multiple-polar-volumes" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Processing multiple polar volumes<a href="processing-many-polar-volumes.html#processing-multiple-polar-volumes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This section contains an example for processing a directory of polar volumes into profiles:</p>
<p>First we download more files, and prepare an output directory for storing the processed profiles:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="processing-many-polar-volumes.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we download more data, for a total of one additional hour for the same radar:</span></span>
<span id="cb29-2"><a href="processing-many-polar-volumes.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download_pvolfiles</span>(<span class="at">date_min=</span><span class="fu">as.POSIXct</span>(<span class="st">&quot;2017-05-04 01:40:00&quot;</span>), <span class="at">date_max=</span><span class="fu">as.POSIXct</span>(<span class="st">&quot;2017-05-04 02:40:00&quot;</span>), <span class="at">radar=</span><span class="st">&quot;KHGX&quot;</span>, <span class="at">directory=</span><span class="st">&quot;./data_pvol&quot;</span>)</span>
<span id="cb29-3"><a href="processing-many-polar-volumes.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We will process all the polar volume files downloaded so far:</span></span>
<span id="cb29-4"><a href="processing-many-polar-volumes.html#cb29-4" aria-hidden="true" tabindex="-1"></a>my_pvolfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="st">&quot;./data_pvol&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern=</span><span class="st">&quot;KHGX&quot;</span>)</span>
<span id="cb29-5"><a href="processing-many-polar-volumes.html#cb29-5" aria-hidden="true" tabindex="-1"></a>my_pvolfiles</span>
<span id="cb29-6"><a href="processing-many-polar-volumes.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create output directory for processed profiles</span></span>
<span id="cb29-7"><a href="processing-many-polar-volumes.html#cb29-7" aria-hidden="true" tabindex="-1"></a>outputdir <span class="ot">&lt;-</span> <span class="st">&quot;./data_vp&quot;</span></span>
<span id="cb29-8"><a href="processing-many-polar-volumes.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(outputdir)</span></code></pre></div>
<p>We will use the following custom settings for processing:
* We will use MistNet to screen out precipitation
* we will calculate profile layers of 50 meter width
* we will calculate 60 profile layers, so up to 50<em>60=3000 meter altitude
</em> we will store the profiles in <a href="https://aloftdata.eu/vpts-csv/">VPTS CSV</a> format, by specifying an output file with extension .csv (this file format is fast for reading data back in later)</p>
<p>Note that we enclose the <code>calculate_vp()</code> function in <code>tryCatch()</code> to keep going after errors with specific files</p>
<p>Having generated the profiles, we can read them into R:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="processing-many-polar-volumes.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we assume outputdir contains the path to the directory with processed profiles</span></span>
<span id="cb30-2"><a href="processing-many-polar-volumes.html#cb30-2" aria-hidden="true" tabindex="-1"></a>my_vpfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(outputdir, <span class="at">full.names =</span> <span class="cn">TRUE</span>, <span class="at">pattern=</span><span class="st">&quot;KHGX&quot;</span>)</span>
<span id="cb30-3"><a href="processing-many-polar-volumes.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># print them</span></span>
<span id="cb30-4"><a href="processing-many-polar-volumes.html#cb30-4" aria-hidden="true" tabindex="-1"></a>my_vpfiles</span>
<span id="cb30-5"><a href="processing-many-polar-volumes.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># read them into a vpts object:</span></span>
<span id="cb30-6"><a href="processing-many-polar-volumes.html#cb30-6" aria-hidden="true" tabindex="-1"></a>my_vpts <span class="ot">&lt;-</span> <span class="fu">read_vpts</span>(my_vpfiles)</span></code></pre></div>
<p>You can now continue with visualizing and post-processing as we did earlier:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="processing-many-polar-volumes.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot them between 0 - 3 km altitude:</span></span>
<span id="cb31-2"><a href="processing-many-polar-volumes.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3000</span>))</span>
<span id="cb31-3"><a href="processing-many-polar-volumes.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># because of the rain moving in, our ability to estimate bird profiles slowly drops:</span></span>
<span id="cb31-4"><a href="processing-many-polar-volumes.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s visualize rain by plotting all aerial reflectivity:</span></span>
<span id="cb31-5"><a href="processing-many-polar-volumes.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(my_vpts, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3000</span>), <span class="at">quantity=</span><span class="st">&quot;DBZH&quot;</span>)</span></code></pre></div>
<p>Note that we enclose the <code>calculate_vp()</code> function in <code>tryCatch()</code> to keep going after errors with specific files</p>
</div>
<div id="parallel-processing" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Parallel processing<a href="processing-many-polar-volumes.html#parallel-processing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We may use one of the parallelization packages in R to further speed up our processing. We will use <code>mclapply()</code> from package <code>parallel</code>. First we wrap up the processing statements in a function, so we can make a single call to a single file. We will disable MistNet, as this deep-learning model does not parallelize well on a cpu machine.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="processing-many-polar-volumes.html#cb32-1" aria-hidden="true" tabindex="-1"></a>process_file <span class="ot">&lt;-</span> <span class="cf">function</span>(file_in){</span>
<span id="cb32-2"><a href="processing-many-polar-volumes.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># construct output filename from input filename</span></span>
<span id="cb32-3"><a href="processing-many-polar-volumes.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  file_out <span class="ot">&lt;-</span> <span class="fu">paste</span>(outputdir, <span class="st">&quot;/&quot;</span>, <span class="fu">basename</span>(file_in), <span class="st">&quot;_vp.csv&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb32-4"><a href="processing-many-polar-volumes.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># run calculate_vp()</span></span>
<span id="cb32-5"><a href="processing-many-polar-volumes.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  vp <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">calculate_vp</span>(file_in, file_out, <span class="at">mistnet =</span> <span class="cn">FALSE</span>, <span class="at">h_layer=</span><span class="dv">50</span>, <span class="at">n_layer=</span><span class="dv">60</span>), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb32-6"><a href="processing-many-polar-volumes.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">is.vp</span>(vp)){</span>
<span id="cb32-7"><a href="processing-many-polar-volumes.html#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return TRUE if we calculated a profile</span></span>
<span id="cb32-8"><a href="processing-many-polar-volumes.html#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb32-9"><a href="processing-many-polar-volumes.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb32-10"><a href="processing-many-polar-volumes.html#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># return FALSE if we did not</span></span>
<span id="cb32-11"><a href="processing-many-polar-volumes.html#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb32-12"><a href="processing-many-polar-volumes.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-13"><a href="processing-many-polar-volumes.html#cb32-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb32-14"><a href="processing-many-polar-volumes.html#cb32-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-15"><a href="processing-many-polar-volumes.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="co"># To process a file, we can now run</span></span>
<span id="cb32-16"><a href="processing-many-polar-volumes.html#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="fu">process_file</span>(my_pvolfiles[<span class="dv">1</span>])</span></code></pre></div>
<p>Next, we use <code>mclapply()</code> to do the parallel processing for all files:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="processing-many-polar-volumes.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the parallel library</span></span>
<span id="cb33-2"><a href="processing-many-polar-volumes.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb33-3"><a href="processing-many-polar-volumes.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># detect how many cores we can use. We will keep 2 cores for other tasks and use the rest for processing.</span></span>
<span id="cb33-4"><a href="processing-many-polar-volumes.html#cb33-4" aria-hidden="true" tabindex="-1"></a>number_of_cores <span class="ot">=</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb33-5"><a href="processing-many-polar-volumes.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Available cores:</span></span>
<span id="cb33-6"><a href="processing-many-polar-volumes.html#cb33-6" aria-hidden="true" tabindex="-1"></a>number_of_cores</span>
<span id="cb33-7"><a href="processing-many-polar-volumes.html#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s loop over the files and generate profiles</span></span>
<span id="cb33-8"><a href="processing-many-polar-volumes.html#cb33-8" aria-hidden="true" tabindex="-1"></a>start<span class="ot">=</span><span class="fu">Sys.time</span>()</span>
<span id="cb33-9"><a href="processing-many-polar-volumes.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mclapply</span>(my_pvolfiles, process_file, <span class="at">mc.cores =</span> number_of_cores)</span>
<span id="cb33-10"><a href="processing-many-polar-volumes.html#cb33-10" aria-hidden="true" tabindex="-1"></a>end<span class="ot">=</span><span class="fu">Sys.time</span>()</span>
<span id="cb33-11"><a href="processing-many-polar-volumes.html#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the processing time that has passed:</span></span>
<span id="cb33-12"><a href="processing-many-polar-volumes.html#cb33-12" aria-hidden="true" tabindex="-1"></a>end<span class="sc">-</span>start</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="range-bias-correction.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="further-analysis-outside-biorad.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
